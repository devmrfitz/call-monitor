"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/*
 * Copyright (C) 2023 by Fonoster Inc (https://fonoster.com)
 * http://github.com/fonoster/fonoster
 *
 * This file is part of Fonoster
 *
 * Licensed under the MIT License (the "License");
 * you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 *    https://opensource.org/licenses/MIT
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const util_1 = require("util");
const jsonwebtoken_1 = require("jsonwebtoken");
const logger_1 = __importDefault(require("@fonoster/logger"));
/*
 * issuer 		— Organization who issue the toke.
 * role       — User role
 * accessKey  — User access key
 * expiresIn	— Expiration time after which the token will be invalid.
 * algorithm 	— Encryption algorithm to be used to protect the token.
 */
class JWT {
    async encode(payload, privateKey, expiresIn = "30d") {
        if (!privateKey)
            throw new Error("Token generation failure");
        // @ts-ignore
        return (0, util_1.promisify)(jsonwebtoken_1.sign)({ ...payload }, privateKey, {
            expiresIn
        });
    }
    /**
     * Returns the decoded payload if the signature is valid even if it is expired
     */
    async decode(token, privateKey) {
        try {
            // @ts-ignore
            return (await (0, util_1.promisify)(jsonwebtoken_1.verify)(token, privateKey, {
                ignoreExpiration: false
            }));
        }
        catch (e) {
            logger_1.default.log("error", "@fonoster/auth [Bad token]");
            throw new Error(e);
        }
    }
}
exports.default = JWT;
